{{- if .Values.oidc.enabled -}}
apiVersion: v1
kind: Secret
metadata:
  name: {{ include "library-chart.fullname" . }}-oidc
  labels:
    {{- include "library-chart.labels" . | nindent 4 }}
type: Opaque
stringData:
  {{- /* Generate 32-byte cookie secret if not provided or too short */}}
  {{- $cookieSecret := .Values.oidc.cookieSecret }}
  {{- if or (not $cookieSecret) (lt (len $cookieSecret) 32) }}
  {{- $cookieSecret = randAlphaNum 32 }}
  {{- end }}
  OAUTH2_PROXY_COOKIE_SECRET: {{ $cookieSecret | quote }}
{{- end }}
